# GAN-Based Adversarial Attack Against Malware Detection



## 声明

我们的项目是基于以下github开源项目实现的:

[ZaydH/MalwareGAN: Adversarial Malware Generator Using GANs (github.com)](https://github.com/ZaydH/MalwareGAN)

上述项目基于[*Generating Adversarial Malware Examples for Black-Box Attacks Based on GAN*](https://arxiv.org/abs/1702.05983)这一研究的结果,实现了一个可以生成恶意软件的对抗性样本的GAN.

在上述开源项目的基础上,我们新增了一个ResNet模型来替换其旧有的黑盒检测器.同时,我们改进了GAN的生成器,为其新增了批量归一化层和Dropout层.



## 依赖要求

我们项目的Python依赖已经导出至`requirements.txt`,你可以新建一个Python虚拟环境，并使用以下指令下载依赖：

```
pip install -r requirements.txt
```

我们在实验阶段使用了NVIDIA GeForce RTX 3060 Laptop GPU。如果你想运行我们的项目，请确保你的设备上安装有英伟达的独立显卡和CUDA。



## 运行

### 黑盒检测器

在detector包下，你可以通过直接运行`run.py`模块来测试黑盒检测器的表现。

如果你想训练新的ResNet模型，你可以在`run.py`模块中定义一个新的`RESNET_MODEL_PATH`。之后，打开`train_model()`方法的注释，点击运行。训练结束后，模型将自动保存到你指定的路径下。

### GAN

gan包实现了训练并测试GAN的相关代码，它的驱动脚本被定义在`main.py`中。

脚本的调用指令如下：

```python
python main.py Z BATCH_SIZE NUM_EPOCHS MALWARE_FILE BENIGN_FILE
```

* `Z` -- 潜在向量的维度。必须是正整数。
* `BATCH_SIZE` -- *恶意*样本的批量大小。良性批量大小与`BATCH_SIZE`和总训练样本中良性样本的比例成比例。
* `NUM_EPOCHS` -- 最大训练周期数
* `MALWARE_FILE` -- 指向序列化的`numpy`或`torch`矩阵的路径，其中行代表单个**恶意**文件的二进制特征向量。
* `BENIGN_FILE` -- 指向序列化的`numpy`或`torch`矩阵的路径，其中行代表单个**良性**文件的二进制特征向量。

以下是一个推荐的使用例子：

```
python main.py 10 32 100 data/trial_mal.npy data/trial_ben.npy 
```



## 数据集

我们项目的数据集存放于data文件夹下。

其中，`trail_ben.npy`和`trail_mal.npy`被用于训练GAN。

而`trail_ben.bmp`和`trail_mal.bmp`下的bmp文件被用于训练ResNet。

如果你在训练ResNet前时想自定义训练集和测试集的比例，可以先删除`trail_ben.bmp`和`trail_mal.bmp`下的bmp文件数据，之后更改`npy2bmp.py`中`split_index`的值，最后运行`npy2bmp.py`模块，即可生成新的训练集和测试集。
